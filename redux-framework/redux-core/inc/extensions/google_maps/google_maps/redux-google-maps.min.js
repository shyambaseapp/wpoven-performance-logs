!function(B){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.google_maps=redux.field_objects.google_maps||{},redux.field_objects.google_maps.init=function(e){e=e||B(document).find(".redux-group-tab:visible").find(".redux-container-google_maps:visible"),B(e).each(function(e){var o,t=B(this);let n=t;(n=t.hasClass("redux-field-container")?n:t.parents(".redux-field-container:first")).is(":hidden")||n.hasClass("redux-field-init")&&(n.removeClass("redux-field-init"),o=Boolean(t.find(".redux_framework_google_maps").data("delay-render")),redux.field_objects.google_maps.clickHandler(t),redux.field_objects.google_maps.initMap(t,e,o))})},redux.field_objects.google_maps.initMap=async function(n,e,o){let t,a,l,d,s,i,r,g,m,c,p,_=!1;const u=n.find(".redux_framework_google_maps"),f=u.attr("id");var y=f+"_autocomplete";const v=f+"_map_canvas";var w=B("#"+v);const b=f+"_latitude",h=f+"_longitude",C=f+"_marker_info";let x=u.data("geo-alert");B(u).attr("data-idx",e),!0===o||B("#"+f).hasClass("rendered")||(!0===Boolean(u.data("delay-render"))&&u.addClass("rendered"),r=await google.maps.importLibrary("places"),r=new google.maps.places.Autocomplete(document.getElementById(y),{types:["geocode"]}),t=Boolean(u.data("scroll-wheel")),a=Boolean(u.data("street-view")),l=Boolean(u.data("map-type")),d=u.data("address"),d=(d=decodeURIComponent(d)).trim(),e=w.data("default-lat"),o=w.data("default-long"),s=w.data("default-zoom"),""!==d?""!==e&&""!==o||(_=!0):_=!1,e=e||39.11676722061108,o=o||-100.47761000000003,_?(new google.maps.Geocoder).geocode({address:d},function(e,o){o===google.maps.GeocoderStatus.OK?(g=e[0].geometry.location,i={center:g,zoom:s,streetViewControl:a,mapTypeControl:l,scrollwheel:t,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},mapId:"REDUX_GOOGLE_MAPS"},m=new google.maps.Map(document.getElementById(v),i),n.find("#"+f+"_latitude").val(e[0].geometry.location.lat()),n.find("#"+f+"_longitude").val(e[0].geometry.location.lng())):alert("Geocode was not successful for the following reason: "+o)}):(g=new google.maps.LatLng(e,o),i={center:g,zoom:s,streetViewControl:a,mapTypeControl:l,scrollwheel:t,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},mapId:"REDUX_GOOGLE_MAPS"},m=new google.maps.Map(document.getElementById(v),i)),w=document.getElementById(y),m.controls[google.maps.ControlPosition.TOP_LEFT].push(w),(r=new google.maps.places.Autocomplete(w)).bindTo("bounds",m),e=u.data("marker-tooltip"),e=decodeURIComponent(e),c=new google.maps.InfoWindow,p=new google.maps.Marker({position:g,map:m,anchorPoint:new google.maps.Point(0,-29),draggable:!0,title:e,animation:google.maps.Animation.DROP}),x=decodeURIComponent(x),google.maps.event.addListener(r,"place_changed",function(){var e,o;let t;c.close(),(e=r.getPlace()).geometry?(console.log(e.geometry.viewport),e.geometry.viewport?m.fitBounds(e.geometry.viewport):(m.setCenter(e.geometry.location),m.setZoom(17)),o=u.data("marker-tooltip"),o=decodeURIComponent(o),(p=new google.maps.Marker({position:g,map:m,anchorPoint:new google.maps.Point(0,-29),title:o,clickable:!0,draggable:!0,animation:google.maps.Animation.DROP})).setPosition(e.geometry.location),p.setVisible(!0),t="",e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),c.setContent("<div><strong>"+e.name+"</strong><br>"+t),c.open(m,p),redux.field_objects.google_maps.geoLocate(r),redux.field_objects.google_maps.fillInAddress(n,b,h,r)):window.alert(x)}),google.maps.event.addListener(p,"drag",function(e){document.getElementById(b).value=e.latLng.lat(),document.getElementById(h).value=e.latLng.lng()}),google.maps.event.addListener(p,"dragend",function(){redux_change(n.find(".redux_framework_google_maps"))}),m.addListener("zoom_changed",function(){n.find(".google_m_zoom_input").val(m.getZoom())}),c=new google.maps.InfoWindow,google.maps.event.addListener(p,"click",function(){var e=document.getElementById(C).value;""!==e&&(c.setContent(e),c.open(m,p))}))},redux.field_objects.google_maps.fillInAddress=function(e,o,t,n){var a,l,d,s=e.find(".redux_framework_google_maps").attr("id"),i={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"},r=n.getPlace();let g,m;for(g in document.getElementById(o).value=r.geometry.location.lat(),document.getElementById(t).value=r.geometry.location.lng(),i)i.hasOwnProperty(g)&&(g=s+"_"+g,document.getElementById(g).value="",document.getElementById(g).disabled=!1);for(d=r.address_components.length,m=0;m<d;m+=1)i[a=r.address_components[m].types[0]]&&(l=r.address_components[m][i[a]],document.getElementById(s+"_"+a).value=l)},redux.field_objects.google_maps.geoLocate=function(t){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o=new google.maps.Circle({center:o,radius:e.coords.accuracy});t.setBounds(o.getBounds())})},redux.field_objects.google_maps.clickHandler=function(o){o.find(".google_m_api_key_button").on("click",function(){var e=o.find(".google_m_api_key_wrapper");e.is(":visible")?e.slideUp("fast",function(){o.find("#google_m_api_key_input").trigger("focus")}):e.slideDown("medium",function(){o.find("#google_m_api_key_input").trigger("focus")})}),o.find(".google_m_autocomplete").on("keypress",function(e){13===e.keyCode&&e.preventDefault()}),o.find(".google_m_autocomplete").on("click",function(e){B(this).trigger("focus"),B(this).trigger("select"),e.preventDefault()})}}(jQuery);